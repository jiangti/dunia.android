<?php
    $address = $this->pub->address;
    $type    = $this->pub->pubType;
?>

<div class="container content">
    <div class="pub-overview row">
        <div class="span12">

            <h1>
                <?php if ($type && $type->icon) { echo '<img src="' . $type->icon . '" width="32" height="32" /> '; } echo $this->pub->name; ?>
            </h1>

            <div class="row">

                <div id="sidebar-row" class="span6">
                    <div class="sidebar" id="overview-sidebar">
                    <div class="details">
                        <a id="street-view" href="#" class="btn btn-mini btn-info">Street View</a>
                        <div id="map_canvas" style="width: 100%; height: 200px;"></div>
                        <div class="contact">
                            <div class="address"><?php echo $address->formatOutput('<br />'); ?></div>
                            <div class="urls">
                                <div><a href="<?php echo $this->pub->url; ?>"><?php echo $this->pub->url; ?></a></div>
                                <div><a href="mailto:<?php echo $this->pub->email; ?>"><?php echo $this->pub->email; ?></a></div>
                            </div>
                        </div>
                    </div>

                    <div class="ribbon-wrapper">
                        <div class="ribbon-front">
                            <h2>Weekly Specials</h2>
                        </div>
                        <div class="ribbon-edge-topleft"></div>
                        <div class="ribbon-edge-topright"></div>
                        <div class="ribbon-edge-bottomleft"></div>
                        <div class="ribbon-edge-bottomright"></div>
                        <div class="ribbon-back-left"></div>
                        <div class="ribbon-back-right"></div>
                    </div>
                    
                    <?php echo $this->partial('partials/promo-table.phtml', array('pub' => $this->pub)); ?>
                    
                    <ul>
                        <?php foreach($this->changeLogs as $changeLog): ?>
                            <li><?php echo $changeLog; ?> - <?php echo $this->formatDate($changeLog->datetime); ?></li>
                        <?php endforeach; ?>
                    </ul>
                    
                    </div>
                </div>

                <div id="content-row" class="span6">
                    <div style="padding-left: 10px;"">
                        <?php
                        $images = $this->pub->getImageLinks();

                        if (count($images)) : ?>
                            <div id="photos">
                                <h2>Photos</h2>
                                <ul>
                                    <?php
                                    foreach ($images as $img) {
                                        echo '<li>
                                        <a href="/phpThumb/phpThumb.php?src=' . $img . '&amp;w=600&amp;ar=x">
                                            <img class="venuePic" src="/phpThumb/phpThumb.php?src=' . $img . '&amp;w=125&amp;h=125&amp;zc=1&amp;ar=x"/>
                                        </a>
                                        </li>';
                                    } ?>
                                </ul>
                            </div>
                            <?php endif; ?>

                            <div id="tipsWrapper">
                            <script type="text/x-handlebars" data-template-name="tipsView">

                                {{#collection tipsCollectionView}}
                                <li>
                                    <div class="tip-container">
                                        <div class="image" style="float: left" >
                                            <a clas {{bindAttr href="content.user.canonicalUrl"}}>
                                            <img {{bindAttr src="content.user.photo"}} width="40" height="40"/>
                                            </a>
                                        </div>
                                        <div>
                                            <div><a {{bindAttr href="content.user.canonicalUrl"}}>{{content.user.firstName}} {{content.user.lastName}}</a> <span class="date">{{content.date}}</span></div>
                                            <div>{{content.text}}</div>
                                        </div>
                                    </div>
                                    <div class="separator"></div>
                                </li>
                                {{/collection}}
                           </script>
                            </div>

                        <div id="edit-section">
                            <?php if($this->pubRow): ?>
                            <div class="sticky-style alpha" id="image-region">
                                <?php foreach($this->pubRow->getImagesWebUri() as $image): ?>
                                <a class="image" href="/phpThumb/phpThumb.php?src=<?php echo $image; ?>&amp;w=600"><img src="/phpThumb/phpThumb.php?src=<?php echo $image; ?>&amp;w=100" alt="" /></a>
                                <?php endforeach; ?>
                            </div>
                            <?php endif; ?>
                            <?php echo $this->form; ?>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
<!--
var config = {
	tipUrl: '<?php echo $this->url(array('controller' => 'foursquare', 'action' => 'fetch-tips'), null, true); ?>',
	pub: <?php echo json_encode($this->pubRow->toArray()); ?>,
	lat: <?php echo $address->latitude; ?>,
	long: <?php echo $address->longitude; ?>
};
//-->
</script>