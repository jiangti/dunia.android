<script type="text/javascript">
    $(document).ready(function() {

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
            	var address   = position.address;
                var longitude = position.coords.longitude;
                var latitude  = position.coords.latitude;

                if (address) {
                    $("#footer").html("<p>Near " + address.streetNumber + ' ' + address.street + ' in ' + address.city + '</p>');
                } else {
                    var geocoder = new google.maps.Geocoder();
                    var latlng   = new google.maps.LatLng(latitude, longitude);

                    geocoder.geocode({'latLng': latlng}, function(results, status) {
                        if (status == google.maps.GeocoderStatus.OK) {
                            if (results[1]) {

                                $("#footer").html("<p>Near " + results[1].formatted_address + '</p>');
                            }
                        }
                    });
                }
                
                $.ajax({
                    type : 'POST',
                    url  : '/index/locate',
                    data : {long: longitude, lat: latitude},
                    success : function (data) {
                        $("#info").html(data);
                        $("#info").find('ul').listview();
                    }
                });
                
            }, 
            function (msg) {
                var s = document.querySelector('#info');
                s.innerHTML = typeof msg == 'string' ? msg : "failed";
                s.className = 'fail';
                
            });
        } else {
            $('#info').html('Geolocation is not supported :(');
        }
    });

</script>


<div id="info">
    Please wait while we locate you and find the closest deals.
</div>
