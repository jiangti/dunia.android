<div id="header" style="margin: 0;">
    <a style="float: left;" id="logo" href="/">Dunia</a>
	<div style="margin: 3px; float: left;">
		<?php echo $this->form; ?>
	</div>
	<div style="float: right; margin: 7px">
		<?php echo $this->render('partials/nav.phtml'); ?>
   	</div>
</div>
<div id="map_canvas" style="height:95%;"></div>

<div id="bottom-info-bar">
	<div class="left summary" id="summary-bar">
		<script type="text/x-handlebars"  data-template-name="summary-bar">
		{{#each summaries}}
    		<a href="#" {{action "toggle"}}><img src="{{unbound smallIcon}}" />{{count}}</a>
		{{/each}}
		</script>
	</div>
	<div class="left">
        <?php echo $this->partial('partials/addthis.phtml'); ?>
	</div>
</div>

<script type="text/javascript">

$(document).ready(function() {

    var amHere = new google.maps.LatLng('<?php echo $this->lat; ?>', '<?php echo $this->long; ?>');
    var myOptions = {
        zoom: 15,
        maxZoom: 20,
        center: amHere,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    };

    AppMap = Dunia.Map.create({
        longitude: '<?php echo $this->long; ?>',
        latitude:  '<?php echo $this->lat; ?>',
        map:       new google.maps.Map(document.getElementById("map_canvas"), myOptions)
    });


    var input = document.getElementById('location');
    var autocomplete = new google.maps.places.Autocomplete(input);

    autocomplete.bindTo('bounds', AppMap.map);

    google.maps.event.addListener(autocomplete, 'place_changed', function() {
    	var place = autocomplete.getPlace();
    	AppMap.map.setCenter(place.geometry.location);
    });

	var view = Ember.View.create({
		templateName: 'summary-bar',
		summaries: Dunia.summary.summaries,
		toggle: function(event) {
			event.preventDefault();
			var object = event.context;

			object.set('flag', !(object.get('flag')))
			AppMap.setMarkersVisible(object.get('name'), object.get('flag'))
		}
	});


	view.appendTo('#summary-bar');


    google.maps.event.addListener(AppMap.map, 'tilesloaded', function(event) {
    	AppMap.fetchBars();
    });

});
</script>
