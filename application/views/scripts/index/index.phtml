<div id="header" style="margin: 0;">
    <a style="float: left;" id="logo" href="/">Dunia</a>
	<div style="margin: 3px; float: left;">
		<?php echo $this->form; ?>
	</div>
	<div style="float: right; margin: 7px">
		<?php echo $this->render('partials/nav.phtml'); ?>
   	</div>
</div>
<div id="map_canvas" style="height:95%;"></div>

<div id="bottom-info-bar">
	<div class="left summary" id="summary-bar">
		<script type="text/x-handlebars" data-template-name="summary-bar">
    		<a href="#"><img src="/img/icons/markers/full_sml.png" />{{summary.later}}</a>
    		<a href="#"><img src="/img/icons/markers/half_sml.png" />{{summary.now}}</a>
    		<a href="#"><img src="/img/icons/markers/empty_sml.png" />{{summary.earlier}}</a>
    		<a href="#"><img src="/img/icons/markers/beer_sml.png" />{{summary.none}}</a>
		</script>
	</div>
	<div class="left">
        <?php echo $this->partial('partials/addthis.phtml'); ?>
	</div>
</div>

<script type="text/javascript">

$(document).ready(function() {

    var amHere = new google.maps.LatLng('<?php echo $this->lat; ?>', '<?php echo $this->long; ?>');
    var myOptions = {
        zoom: 15,
        maxZoom: 20,
        center: amHere,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    };

    var Map = Dunia.Map.create({
        longitude: '<?php echo $this->long; ?>',
        latitude:  '<?php echo $this->lat; ?>',
        map:       new google.maps.Map(document.getElementById("map_canvas"), myOptions)
    });

	var view = Ember.View.create({
		templateName: 'summary-bar',
		summary: Dunia.summary
	});

	view.appendTo('#summary-bar');

    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
            Map.longitude = position.coords.longitude;
            Map.latitude  = position.coords.latitude;
            Map.center();
        });
    }

    google.maps.event.addListener(Map.map, 'tilesloaded', function(event) {
        Map.fetchBars();
    });

});
</script>
